{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- Blog Detail Section -->
<section class="section-blog padding-tb-50">
    <div class="container">
        <!-- Breadcrumb -->
        <div class="bb-breadcrumb mb-40" data-aos="fade-up" data-aos-duration="1000">
            <ul class="flex items-center justify-center gap-2">
                <li><a href="/">Home</a></li>
                <li><i class="ri-arrow-right-s-line"></i></li>
                <li class="active">Blog Details</li>
            </ul>
            <h2 class="bb-title text-center mt-2">{{ blog.title }}</h2>
        </div>

        <!-- Blog Content -->
        <div class="row mb-minus-24">
            <div class="col-12 mb-24" data-aos="fade-up" data-aos-duration="1000" data-aos-delay="200">
                <div class="bb-blog-card bb-blog-detail">
                    <div class="blog-image">
                        {% if blog.image %}
                        <img src="{{ blog.image.url }}" alt="{{ blog.title }}">
                        {% else %}
                        <img src="{% static 'assets/img/blog/default.jpg' %}" alt="Blog Image">
                        {% endif %}
                    </div>
                    <div class="blog-contact">
                        <div class="blog-meta">
                            <span><i class="ri-calendar-line"></i> {{ blog.created_at|date:"F d, Y" }}</span>
                            <span><i class="ri-folder-2-line"></i> {{ blog.category.name }}</span>
                        </div>
                        <h3>{{ blog.title }}</h3>
                        <div class="blog-detail-content">
                            {{ blog.content|safe }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comments Section -->
            <div class="col-12 mt-40" data-aos="fade-up" data-aos-duration="1000" data-aos-delay="400">
                <div class="bb-comment-section">
                    <h4 class="bb-subtitle mb-4">Comments ({{ blog_comments.count }})</h4>

                    {% for comment in blog_comments %}
                    <div class="bb-single-comment">
                        <div class="comment-avatar">
                            {% if comment.image %}
                                <img src="{{ comment.image.url }}" alt="{{ comment.name }}">
                            {% else %}
                                <img src="{% static 'assets/img/user/default.jpeg' %}" alt="User">
                            {% endif %}
                        </div>
                        <div class="comment-body">
                            <h5>{{ comment.name }}</h5>
                            <span class="comment-date">{{ comment.created_at|date:"F j, Y" }}</span>
                            <p>{{ comment.comment }}</p>
                            <a href="javascript:void(0)" class="reply-btn" onclick="toggleReplyForm({{ comment.id }})">
                                <i class="ri-reply-line"></i> Reply
                            </a>
                        </div>
                    </div>

                    <!-- Replies -->
                    {% for reply in comment.replies.all %}
                    <div class="bb-single-comment reply">
                        <div class="comment-avatar">
                            {% if reply.image %}
                                <img src="{{ reply.image.url }}" alt="{{ reply.name }}">
                            {% else %}
                                <img src="{% static 'assets/img/user/default.jpeg' %}" alt="User">
                            {% endif %}
                        </div>
                        <div class="comment-body">
                            <h5>{{ reply.name }}</h5>
                            <span class="comment-date">{{ reply.created_at|date:"F j, Y" }}</span>
                            <p>{{ reply.reply_text }}</p>
                        </div>
                    </div>
                    {% endfor %}

                    <!-- Reply Form -->
                    <div id="reply-form-{{ comment.id }}" class="bb-reply-form hidden">
                        <form method="post" enctype="multipart/form-data" action="{% url 'home:comment_reply' %}">
                            {% csrf_token %}
                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <input type="text" name="name" placeholder="Full Name" required class="form-control">
                                </div>
                                <div class="col-md-6">
                                    <input type="file" name="image" accept="image/*" class="form-control">
                                </div>
                                <div class="col-md-12">
                                    <textarea name="reply_text" placeholder="Write your reply..." required class="form-control"></textarea>
                                    <button type="submit" class="bb-btn-2 mt-2">Submit Reply</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Leave a Comment -->
            <div class="col-12 mt-50" data-aos="fade-up" data-aos-duration="1000" data-aos-delay="600">
                <div class="bb-comment-form">
                    <h4 class="bb-subtitle mb-4">Leave a Comment</h4>
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="row g-3">
                            <div class="col-md-6">
                                <input type="text" name="name" placeholder="Full Name" required class="form-control">
                            </div>
                            <div class="col-md-6">
                                <input type="file" name="image" accept="image/*" class="form-control">
                            </div>
                            <div class="col-md-12">
                                <textarea name="comment" placeholder="Write your comment..." required class="form-control"></textarea>
                                <button type="submit" name="comment_submit" class="bb-btn-2 mt-2">Submit Comment</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</section>

<!-- SweetAlert Toast -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
{% if messages %}
{% for message in messages %}
Swal.fire({
    toast: true,
    icon: 'success',
    position: 'bottom-end',
    title: '{{ message }}',
    showConfirmButton: false,
    timer: 4000
});
{% endfor %}
{% endif %}
</script>

<!-- Toggle Reply Form -->
<script>
function toggleReplyForm(commentId) {
    const form = document.getElementById(`reply-form-${commentId}`);
    form.classList.toggle('hidden');
}
</script>

<style>
.hidden { display: none; }

.bb-breadcrumb ul {
    list-style: none;
    padding: 0;
}
.bb-breadcrumb ul li {
    display: inline-block;
    color: #666;
}
.bb-breadcrumb ul li.active {
    font-weight: 600;
    color: #000;
}

.bb-blog-card.bb-blog-detail img {
    width: 100%;
    border-radius: 10px;
}
.bb-blog-card .blog-contact {
    margin-top: 20px;
}
.bb-comment-section {
    border-top: 1px solid #eee;
    padding-top: 30px;
}
.bb-single-comment {
    display: flex;
    align-items: flex-start;
    margin-bottom: 25px;
}
.bb-single-comment.reply {
    margin-left: 60px;
}
.comment-avatar img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
}
.comment-body {
    margin-left: 15px;
}
.comment-body h5 {
    margin-bottom: 5px;
    font-weight: 600;
}
.reply-btn {
    font-size: 14px;
    color: var(--theme-color, #007bff);
}
.bb-reply-form {
    margin-left: 75px;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 8px;
}
</style>

{% endblock %}
